{"mappings":"C,A,WCiCA,eAAe,EAAgB,CAAM,EACnC,IAAM,EAAW,MAAM,OAAO,OAAO,CAAC,WAAW,CAAC,CAChD,OAAQ,0BACR,GAAI,GAAU,CAAC,CAAC,AAClB,GAEA,GADA,QAAQ,GAAG,CAAC,2BAA4B,GACpC,GAAY,EAAS,OAAO,CAE9B,OADc,EAAS,IAAI,AAEtB,EACL,IAAM,EAAW,GAAU,OAAS,UAEpC,OADA,QAAQ,IAAI,CAAC,SAAU,GACjB,AAAI,MAAM,EAClB,CACF,CASA,eAAe,EAAiB,CAAO,EACrC,IAAI,EAAa,EAAQ,SAAS,CAAC,GAAG,CACtC,GAAI,CAAC,EACH,OAUF,IAAM,EAAY,AARJ,CAAA,MAAM,OAAO,OAAO,CAAC,MAAM,CAAC,CACxC,IAAK,EACL,KAAM,QACN,MAAO,IACP,OAAQ,IACR,KAAM,KAAK,KAAK,CAAE,AAAA,CAAA,OAAO,KAAK,CAAG,GAAA,EAAO,GACxC,IAAK,KAAK,KAAK,CAAE,AAAA,CAAA,OAAO,MAAM,CAAG,GAAA,EAAO,EAC1C,EAAA,EACwB,EAAE,CAE1B,OADA,QAAQ,GAAG,CAAC,CAAC,wBAAwB,EAAE,EAAA,CAAW,EAC3C,MAAM,IAAI,QAAQ,AAAC,IACxB,IAAM,EAAU,MAAO,IACjB,IAAa,IACf,OAAO,OAAO,CAAC,SAAS,CAAC,cAAc,CAAC,GAExC,EADc,MAAM,EAAgB,CAAE,QAAS,CAAA,CAAK,IAGxD,EACA,OAAO,OAAO,CAAC,SAAS,CAAC,WAAW,CAAC,EACvC,EACF,CAEA,OAAO,sBAAsB,CAnF7B,WACE,IAAM,EAAO,CACL,gBAAN,SACS,MAAM,IAEf,MAAM,mBACJ,IAAI,EAAO,MAAM,EAAK,eAAe,EACrC,OAAM,EAAiB,EACzB,EACA,MAAM,gBAAgB,CAAA,SAAE,CAAQ,CAAA,YAAE,CAAW,CAAE,CAAG,CAAC,CAAC,EAElD,IAAI,EAAa,AADN,CAAA,MAAM,EAAK,eAAe,EAArC,EACsB,SAAS,CAAC,IAAI,CAAC,AAAC,GACpC,AAAI,EACK,EAAE,MAAM,CAAC,EAAE,GAAK,EAEhB,EAAE,MAAM,CAAC,KAAK,GAAK,GAAe,cAG7C,OAAO,GAAY,iBACrB,CACF,EACA,OAAO,CACT,C","sources":["<anon>","src/ui.js"],"sourcesContent":["(function () {\nfunction $264b11b18bc87cf6$var$createEzrevenueService() {\n    const self = {\n        async getCustomerInfo () {\n            return await $264b11b18bc87cf6$var$getCustomerInfo();\n        },\n        async showPaywallPopup () {\n            let info = await self.getCustomerInfo();\n            await $264b11b18bc87cf6$var$showPaywallPopup(info);\n        },\n        async isBalanceUsable ({ equityId: equityId, equityAlias: equityAlias } = {}) {\n            let info = await self.getCustomerInfo();\n            let vipBalance = info.balance_s.find((x)=>{\n                if (equityId) return x.equity.id === equityId;\n                else return x.equity.alias === equityAlias || 'equity_vip';\n            });\n            return vipBalance?.is_balance_usable;\n        }\n    };\n    return self;\n}\n/**\n * 获取会员信息\n * https://www.ezboti.com/docs/revenue/api-customer-info/\n * @async\n * @param {Object} [params] 可选参数\n * @param {boolean} [params.refresh] 是否强制刷新\n * @returns {Promise<Object>} 会员信息对象\n * @throws {Error} 获取失败时抛出异常\n */ async function $264b11b18bc87cf6$var$getCustomerInfo(params) {\n    const response = await chrome.runtime.sendMessage({\n        action: 'ezrevenue_customer_info',\n        ...params || {}\n    });\n    console.log('getCustomerInfo response', response);\n    if (response && response.success) {\n        let vipInfo = response.data;\n        return vipInfo;\n    } else {\n        const errorMsg = response?.error || \"\\u83B7\\u53D6\\u4F1A\\u5458\\u4FE1\\u606F\\u5931\\u8D25\";\n        console.info('Error:', errorMsg);\n        throw new Error(errorMsg);\n    }\n}\n/**\n * 显示支付界面弹窗\n * @async\n * @param {Object} vipInfo 会员信息\n * @param {Object} vipInfo.home_link 支付界面链接信息\n * @description 居中显示800x600的支付界面窗口，关闭后刷新会员状态\n */ async function $264b11b18bc87cf6$var$showPaywallPopup(vipInfo) {\n    let paywallUrl = vipInfo.home_link.url;\n    if (!paywallUrl) return;\n    const popup = await chrome.windows.create({\n        url: paywallUrl,\n        type: 'popup',\n        width: 800,\n        height: 600,\n        left: Math.round((screen.width - 800) / 2),\n        top: Math.round((screen.height - 600) / 2)\n    });\n    const myPopupId = popup.id;\n    console.log(`Window created with ID: ${myPopupId}`);\n    return await new Promise((resolve)=>{\n        const handler = async (windowId)=>{\n            if (windowId === myPopupId) {\n                chrome.windows.onRemoved.removeListener(handler);\n                let vipInfo = await $264b11b18bc87cf6$var$getCustomerInfo({\n                    refresh: true\n                });\n                resolve(vipInfo);\n            }\n        };\n        chrome.windows.onRemoved.addListener(handler);\n    });\n}\nwindow.createEzrevenueService = $264b11b18bc87cf6$var$createEzrevenueService;\n\n})();\n//# sourceMappingURL=ui.js.map\n","function createEzrevenueService() {\n  const self = {\n    async getCustomerInfo() {\n      return await getCustomerInfo()\n    },\n    async showPaywallPopup() {\n      let info = await self.getCustomerInfo()\n      await showPaywallPopup(info)\n    },\n    async isBalanceUsable({ equityId, equityAlias } = {}) {\n      let info = await self.getCustomerInfo()\n      let vipBalance = info.balance_s.find((x) => {\n        if (equityId) {\n          return x.equity.id === equityId\n        } else {\n          return x.equity.alias === equityAlias || 'equity_vip'\n        }\n      })\n      return vipBalance?.is_balance_usable\n    },\n  }\n  return self\n}\n\n/**\n * 获取会员信息\n * https://www.ezboti.com/docs/revenue/api-customer-info/\n * @async\n * @param {Object} [params] 可选参数\n * @param {boolean} [params.refresh] 是否强制刷新\n * @returns {Promise<Object>} 会员信息对象\n * @throws {Error} 获取失败时抛出异常\n */\nasync function getCustomerInfo(params) {\n  const response = await chrome.runtime.sendMessage({\n    action: 'ezrevenue_customer_info',\n    ...(params || {}),\n  })\n  console.log('getCustomerInfo response', response)\n  if (response && response.success) {\n    let vipInfo = response.data\n    return vipInfo\n  } else {\n    const errorMsg = response?.error || '获取会员信息失败'\n    console.info('Error:', errorMsg)\n    throw new Error(errorMsg)\n  }\n}\n\n/**\n * 显示支付界面弹窗\n * @async\n * @param {Object} vipInfo 会员信息\n * @param {Object} vipInfo.home_link 支付界面链接信息\n * @description 居中显示800x600的支付界面窗口，关闭后刷新会员状态\n */\nasync function showPaywallPopup(vipInfo) {\n  let paywallUrl = vipInfo.home_link.url\n  if (!paywallUrl) {\n    return\n  }\n  const popup = await chrome.windows.create({\n    url: paywallUrl,\n    type: 'popup',\n    width: 800,\n    height: 600,\n    left: Math.round((screen.width - 800) / 2),\n    top: Math.round((screen.height - 600) / 2),\n  })\n  const myPopupId = popup.id\n  console.log(`Window created with ID: ${myPopupId}`)\n  return await new Promise((resolve) => {\n    const handler = async (windowId) => {\n      if (windowId === myPopupId) {\n        chrome.windows.onRemoved.removeListener(handler)\n        let vipInfo = await getCustomerInfo({ refresh: true })\n        resolve(vipInfo)\n      }\n    }\n    chrome.windows.onRemoved.addListener(handler)\n  })\n}\n\nwindow.createEzrevenueService = createEzrevenueService\n"],"names":["$264b11b18bc87cf6$var$getCustomerInfo","params","response","chrome","runtime","sendMessage","action","console","log","success","data","errorMsg","error","info","Error","$264b11b18bc87cf6$var$showPaywallPopup","vipInfo","paywallUrl","home_link","url","myPopupId","popup","windows","create","type","width","height","left","Math","round","screen","top","id","Promise","resolve","handler","windowId","onRemoved","removeListener","refresh","addListener","window","createEzrevenueService","self","getCustomerInfo","showPaywallPopup","isBalanceUsable","equityId","equityAlias","vipBalance","balance_s","find","x","equity","alias","is_balance_usable"],"version":3,"file":"ui.js.map"}